---
import BaseLayout from '../layouts/BaseLayout.astro';
import StepperNavigation from '../components/StepperNavigation.svelte';
import Gallery from '../components/Gallery/Gallery.svelte';
import RSVPForm from '../components/RSVP/RSVPForm.svelte';
import Guestbook from '../components/Guestbook/Guestbook.svelte';
import InvitationCover from '../components/InvitationCover.astro';
import InvitationContent from '../components/InvitationContent.astro';
import TimelineSection from '../components/TimelineSection.astro';
import OurStorySection from '../components/OurStorySection.astro';
import BridalPartySection from '../components/BridalPartySection.astro';
import FAQSection from '../components/FAQSection.svelte';
---

<BaseLayout title="Nijao Wedding - Join Us for Our Special Day">
  <StepperNavigation client:load />

  <main>
    <!-- Hero Section - Wedding Invitation -->
    <section id="home" class="relative min-h-screen flex flex-col items-center justify-center bg-wedding-oatmilk overflow-hidden m-0 p-0" style="margin: 0; padding: 0;">
      <!-- Decorative floating elements -->
      <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-20 left-10 w-20 h-20 bg-wedding-raspberry/15 rounded-full blur-lg animate-float"></div>
        <div class="absolute top-40 right-20 w-32 h-32 bg-wedding-dark-matcha-green/15 rounded-full blur-xl animate-float animate-delay-400"></div>
        <div class="absolute bottom-20 left-1/4 w-24 h-24 bg-wedding-raspberry/10 rounded-full blur-lg animate-float animate-delay-600"></div>
      </div>

      <InvitationCover />

      <InvitationContent />
    </section>

    <script>
      if (typeof document !== 'undefined' && typeof window !== 'undefined') {
        // Invitation open/close logic
        const cover = document.getElementById('invitation-cover');
        const content = document.getElementById('invitation-content');
        const openBtn = document.getElementById('open-invitation-btn');
        const closeBtn = document.getElementById('close-invitation-btn');
        const STORAGE_KEY = 'wedding-invitation-opened';
        let isInvitationOpen = false;

        // Check if invitation was previously opened
        function checkInvitationState() {
          const wasOpened = localStorage.getItem(STORAGE_KEY) === 'true';
          if (wasOpened && cover && content) {
            cover.classList.add('hidden');
            content.classList.remove('hidden');
            content.style.opacity = '1';
            content.style.transform = 'scale(1) translateY(0)';
            isInvitationOpen = true;
            document.body.style.overflow = '';
            document.documentElement.style.overflow = '';
            window.dispatchEvent(new CustomEvent('invitation-opened'));
          } else {
            document.body.style.overflow = 'hidden';
            document.documentElement.style.overflow = 'hidden';
          }
        }

        function preventScroll(e: Event) {
          if (!isInvitationOpen) {
            e.preventDefault();
            e.stopPropagation();
            return false;
          }
        }

        function preventWheel(e: WheelEvent) {
          if (!isInvitationOpen) {
            e.preventDefault();
            return false;
          }
        }

        function preventKeyboardScroll(e: KeyboardEvent) {
          if (!isInvitationOpen) {
            const scrollKeys = ['ArrowDown', 'ArrowUp', 'PageDown', 'PageUp', 'Home', 'End', ' '];
            if (scrollKeys.includes(e.key)) {
              e.preventDefault();
              return false;
            }
          }
        }

        function preventTouchMove(e: TouchEvent) {
          if (!isInvitationOpen) {
            e.preventDefault();
            return false;
          }
        }

        function openInvitation() {
          if (!cover || !content) return;
          isInvitationOpen = true;
          localStorage.setItem(STORAGE_KEY, 'true');
          const envelopeFlap = document.getElementById('envelope-flap');
          const envelopeContainer = document.getElementById('envelope-container');

          if (envelopeFlap && envelopeContainer) {
            envelopeFlap.style.transform = 'rotateX(-180deg)';
            envelopeFlap.style.transition = 'transform 1s cubic-bezier(0.4, 0, 0.2, 1)';
            setTimeout(() => {
              cover.style.opacity = '0';
              cover.style.transform = 'scale(0.95)';
              cover.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
              cover.style.pointerEvents = 'none';
              setTimeout(() => {
                cover.classList.add('hidden');
                content.classList.remove('hidden');
                content.style.opacity = '0';
                content.style.transform = 'scale(0.9) translateY(30px)';
                window.dispatchEvent(new CustomEvent('invitation-opened'));
                document.body.style.overflow = '';
                document.documentElement.style.overflow = '';
                requestAnimationFrame(() => {
                  content.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
                  content.style.opacity = '1';
                  content.style.transform = 'scale(1) translateY(0)';
                });
              }, 500);
            }, 1000);
          } else {
            cover.style.opacity = '0';
            cover.style.transform = 'scale(0.8) translateY(-50px)';
            cover.style.pointerEvents = 'none';
            setTimeout(() => {
              cover.classList.add('hidden');
              content.classList.remove('hidden');
              content.style.opacity = '0';
              content.style.transform = 'scale(0.9) translateY(30px)';
              window.dispatchEvent(new CustomEvent('invitation-opened'));
              document.body.style.overflow = '';
              document.documentElement.style.overflow = '';
              requestAnimationFrame(() => {
                content.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
                content.style.opacity = '1';
                content.style.transform = 'scale(1) translateY(0)';
              });
            }, 300);
          }
        }

        function closeInvitation() {
          if (!cover || !content) return;
          isInvitationOpen = false;
          document.body.style.overflow = 'hidden';
          document.documentElement.style.overflow = 'hidden';
          content.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
          content.style.opacity = '0';
          content.style.transform = 'scale(0.9) translateY(30px)';
          window.dispatchEvent(new CustomEvent('invitation-closed'));
          setTimeout(() => {
            content.classList.add('hidden');
            cover.classList.remove('hidden');
            const envelopeFlap = document.getElementById('envelope-flap');
            if (envelopeFlap) {
              envelopeFlap.style.transform = 'rotateX(0deg)';
              envelopeFlap.style.transition = 'transform 1s cubic-bezier(0.4, 0, 0.2, 1)';
            }
            cover.style.opacity = '0';
            cover.style.transform = 'scale(0.95)';
            cover.style.pointerEvents = 'auto';
            requestAnimationFrame(() => {
              cover.style.transition = 'opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1), transform 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
              cover.style.opacity = '1';
              cover.style.transform = 'scale(1)';
            });
          }, 300);
        }

        checkInvitationState();
        if (!isInvitationOpen) {
          window.addEventListener('wheel', preventWheel, { passive: false });
          window.addEventListener('touchmove', preventTouchMove, { passive: false });
          window.addEventListener('keydown', preventKeyboardScroll);
          document.addEventListener('scroll', preventScroll, true);
        }
        if (openBtn) openBtn.addEventListener('click', openInvitation);
        if (closeBtn) closeBtn.addEventListener('click', closeInvitation);
        window.addEventListener('beforeunload', () => {
          window.removeEventListener('wheel', preventWheel);
          window.removeEventListener('touchmove', preventTouchMove);
          window.removeEventListener('keydown', preventKeyboardScroll);
          document.removeEventListener('scroll', preventScroll, true);
        });
      }
    </script>

    <TimelineSection />

    <OurStorySection />

    <BridalPartySection />

    <!-- RSVP Section -->
    <section id="rsvp" class="pt-12 pb-20 bg-wedding-dark-matcha-green/5">
      <div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-4xl sm:text-5xl font-brush text-center text-wedding-dark-matcha-green mb-4">
          RSVP
        </h2>
        <p class="text-center text-gray-700 mb-4 text-lg">
          We'd love to celebrate with you! Please let us know if you'll be joining us.
        </p>
        <p class="text-center text-wedding-raspberry mb-12 text-lg font-semibold">
          Please RSVP by November 8, 2026, so we can finalize our counts with the venues.
        </p>

        <RSVPForm client:load />
      </div>
    </section>

    <!-- Gallery Section -->
    <section id="gallery" class="pt-12 pb-20 bg-gradient-to-b from-wedding-raspberry/10 via-wedding-dark-matcha-green/10 to-transparent">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-4xl sm:text-5xl font-brush text-center text-wedding-dark-matcha-green mb-12">
          Our Photo Gallery
        </h2>

        <Gallery client:load />
      </div>
    </section>

    <!-- FAQ Section -->
    <FAQSection client:load />

    <!-- Guestbook Section -->
    <section id="guestbook" class="pt-12 pb-20 bg-gradient-to-b from-wedding-raspberry/10 via-wedding-dark-matcha-green/10 to-transparent">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-4xl sm:text-5xl font-brush text-center text-wedding-dark-matcha-green mb-4">
          Guestbook
        </h2>
        <p class="text-center text-gray-700 mb-12 text-lg">
          Share your well wishes and memories with us!
        </p>

        <Guestbook client:load />
      </div>
    </section>
  </main>

  <footer class="bg-gradient-to-r from-wedding-raspberry to-wedding-dark-matcha-green text-white py-8 animate-fade-in">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <p class="text-sm animate-pulse-slow">
        Made with ❤️ for our special day
      </p>
    </div>
  </footer>
</BaseLayout>

